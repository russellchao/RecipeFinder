<h1>{{ "Preference Selection" }}</h1>


<form method="post" action="{% url 'recipefinder:results' %}">
    {% csrf_token %}
    {% for category in categories %}
    <fieldset>
        <legend><h2>{{ category.category_text }}</h2></legend>

        <!-- Create a flex container for columns -->
        <div class="checkbox_container">
            {% for choice in category.choice_set.all %}
                {% if forloop.counter0|divisibleby:3 %}
                <!-- Start a new column every 3 items -->
                <div class="checkbox_column">
                {% endif %}

                <!-- Checkbox item -->
                <div class="checkbox_items">
                    <input 
                        type="checkbox" 
                        name="choices" 
                        value="{{ choice.id }}"
                        {% if choice.selected %} checked {% endif %}
                        id="choice{{ choice.id }}">
                    <label for="choice{{ choice.id }}">{{ choice.choice_text }}</label><br>
                </div>

                {% if forloop.counter|divisibleby:3 or forloop.last %}
                <!-- Close the column -->
                </div>
                {% endif %}
            {% endfor %}
        </div>

        <p>&nbsp;</p>

        <!-- Buttons for Select/Deselect All for this category -->
        <button type="button" class="select_all" data_category="{{ forloop.counter }}">Select All</button>
        <button type="button" class="deselect_all" data_category="{{ forloop.counter }}">Deselect All</button>

    </fieldset>
    {% endfor %}

    <p>&nbsp;</p>
    
    <button type="submit">Find Recipes</button>
    
</form>

<style>
    .checkbox_container {
        display: flex; 
        gap: 20px; 
    }

    .checkbox_column {
        display: flex;
        flex-direction: column;
    }

    .checkbox_item {
        margin-bottom: 10px; 
    }
</style>


<!-- IGNORE THE SELECT/DESELECT ALL FUNCTIONALITY FOR NOW -->


<script>
    // Function to handle "Select All" for a specific category
    document.querySelectorAll(".select_all").forEach(button => {
        button.addEventListener("click", function () {
            const category = this.dataset.category; // Get the category indentifier
            document.querySelectorAll(".selectable_checkbox[data_category='${category}']").forEach(checkbox =>  {
                checkbox.checked = true; // Select all choices in this category
            });
        });
    });


    // Function to handle "Deselect All" for a specific category
    document.querySelectorAll(".deselect_all").forEach(button => {
        button.addEventListener("click", function () {
            const category = this.dataset.category; // Get the category indentifier
            document.querySelectorAll(".selectable_checkbox[data_category='${category}']").forEach(checkbox =>  {
                checkbox.checked = false; // Select all choices in this category
            });
        });
    });

</script>